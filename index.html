<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Cesium + WebXR Viewer</title>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <style>
    html, body, #cesiumContainer {
      width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; background: black;
    }
    #enterAR, #tokenForm {
      position: absolute; z-index: 1000; font-size: 16px;
    }
    #enterAR {
      top: 10px; left: 10px; padding: 12px 20px; background: #28a745; color: white; border-radius: 6px; cursor: pointer;
    }
    #tokenForm {
      top: 60px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 6px;
    }
    #tokenForm input { width: 250px; margin-bottom: 5px; }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <button id="enterAR">Войти в AR</button>
  <div id="tokenForm">
    <div>
      Access Token: <input id="accessToken" placeholder="Вставьте Access Token">
    </div>
    <div>
      Asset ID: <input id="assetId" placeholder="Вставьте Asset ID">
    </div>
    <button id="loadScene">Загрузить сцену</button>
  </div>
  <script>
    let viewer;

    document.getElementById('loadScene').onclick = async function () {
      const token = document.getElementById('accessToken').value.trim();
      const assetId = document.getElementById('assetId').value.trim();

      if (!token || !assetId) {
        alert("Пожалуйста, введите Access Token и Asset ID");
        return;
      }

      Cesium.Ion.defaultAccessToken = token;

      viewer = new Cesium.Viewer('cesiumContainer', {
        terrainProvider: Cesium.createWorldTerrain(),
        shouldAnimate: true,
        imageryProvider: new Cesium.IonImageryProvider({ assetId: 2 })
      });

      try {
        const kmlDataSource = await Cesium.KmlDataSource.load(
          Cesium.IonResource.fromAssetId(Number(assetId))
        );
        viewer.dataSources.add(kmlDataSource);
        viewer.flyTo(kmlDataSource);
      } catch (error) {
        console.error("Ошибка загрузки KML:", error);
        alert("Ошибка загрузки сцены. Проверьте Asset ID и Token.");
      }
    };

    document.getElementById('enterAR').onclick = function () {
      if (navigator.xr) {
        navigator.xr.requestSession('immersive-ar', { requiredFeatures: ['hit-test'] })
          .then(() => alert("WebXR AR-сессия успешно запущена!"))
          .catch(err => alert("Ошибка запуска AR-сессии: " + err));
      } else {
        alert("Ваш браузер не поддерживает WebXR.");
      }
    };
  </script>
</body>
</html>
